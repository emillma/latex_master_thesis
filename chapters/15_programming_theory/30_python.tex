\section{Concurrent programming in Python}

While asynchronous programmings often is preferred over threads in Python, it is not always possible to use it.
This is especiall true when working with external libraries that are not designed to be used asynchronously and contein blocking calls.
This is for example the case with \gls{gstreamer} and the \gls{arena-api}.
To integrate these libraries with \gls{asyncio} a good approach is to use us a thread pool to run the blocking code and asynchronously wait for the result.
This can be done using the \code{run_in_executor} function in \gls{asyncio}.


\begin{listing}[H]
    \begin{minted}{python}
        def sleep_1sec(): time.sleep(1)
        async def sleep_1sec_async(): await asyncio.sleep(1)

        async def test_asyncio():
            await asyncio.gather(*[sleep_1sec_async() for _ in range(N)])

        def test_thread_pool():
            with ThreadPoolExecutor(max_workers=10000) as ex:
                futures = [ex.submit(sleep_1sec) for _ in range(N)]

        async def test_thread_pool_async():
            loop = asyncio.get_event_loop()
            with ThreadPoolExecutor(max_workers=10000) as ex:
                asyncio.gather(*[loop.run_in_executor(ex, sleep_1sec) for _ in range(10000)])

        def test_threads():
            threads = [threading.Thread(target=do_nothing) for _ in range(10000)]
            [thread.start() for thread in threads]
            [thread.join() for thread in threads]
    \end{minted}
    \caption{Code used to compatre asyncio and threads.}
    \label{listing:concurrency_test}
\end{listing}
\begin{listing}[H]
    \begin{minted}{bash}
        >>> test_asyncio took 1.373797 seconds to complete.
        >>> test_thread_pool took 4.091199 seconds to complete.
        >>> test_thread_pool_async took 4.391777 seconds to complete.
        >>> test_threads took 5.373108 seconds to complete.
    \end{minted}
    \caption{Results when running the code in Listing  \ref{listing:concurrency_test} on the \jx}
\end{listing}

\subsection{Importance of Type Hints}
